<!DOCTYPE html>

<script type="text/javascript">
  Homey.setTitle("Create Dingz devices...");
  Homey.showLoadingOverlay();

  Homey.emit("getDeviceManifests")
    .then((manifests) => {
      manifests.forEach((manifest) => {
        Homey.createDevice(manifest)
          .then((device) => {
            console.debug(`### Device created: ${device.name}`);
            // Homey.alert(`${device.name} device created`, "info");
          })
          .catch((error) => {
            if (!error.message.match("[duplicate_device]")) {
              console.error(`### createDevice: ${manifest.name} > ${error.message}`);
              Homey.alert(error.message, "error");
            }
          });
      });
    })
    .then(() => {
      // Wait until store.address is saved
      setTimeout(() => {
        Homey.done();
        console.log(`Homey.done()`);
      }, 5000);
    })
    .catch((error) => {
      console.error(`getDeviceManifests: ${error.message}`);
      Homey.alert(error.message, "error");
    });
</script>